import { takeEvery, put, call } from '@redux-saga/core/effects';
import { store } from '../configureStore'
import * as api from '@app/services/inkiriApi'
import * as core from './core';
import _ from 'lodash';
import * as utils from '@app/utils/utils';
import moment from 'moment';

// Constantes
const LOAD_BLOCKCHAIN_OPERATIONS         = 'operations/LOAD_BLOCKCHAIN_OPERATIONS'
const SET_BLOCKCHAIN_OPERATIONS          = 'operations/SET_BLOCKCHAIN_OPERATIONS'

const LOAD_OLD_BLOCKCHAIN_OPERATIONS     = 'operations/LOAD_OLD_BLOCKCHAIN_OPERATIONS'
const APEND_BLOCKCHAIN_OPERATIONS        = 'operations/APEND_BLOCKCHAIN_OPERATIONS'

const LOAD_NEW_BLOCKCHAIN_OPERATIONS     = 'operations/LOAD_NEW_BLOCKCHAIN_OPERATIONS'
const PREPEND_BLOCKCHAIN_OPERATIONS      = 'operations/PREPEND_BLOCKCHAIN_OPERATIONS'

const END_LOAD_BLOCKCHAIN_OPERATIONS     = 'operations/END_LOAD_BLOCKCHAIN_OPERATIONS'

const TRY_SET_FILTER_KEY_VALUE           = 'operations/TRY_SET_FILTER_KEY_VALUE';
const SET_FILTER_KEY_VALUE               = 'operations/SET_FILTER_KEY_VALUE';

const TRY_FILTER_OPERATIONS              = 'operations/TRY_FILTER_OPERATIONS';
const SET_FILTERED_OPERATIONS            = 'operations/SET_FILTERED_OPERATIONS';

// const LOAD_OPERATIONS                    = 'operations/LOAD_OPERATIONS'

// Creadores de acciones (se pueden usar desde los compoenentes)
export const loadBlockchainOperations    = ()       =>({ type: LOAD_BLOCKCHAIN_OPERATIONS});
export const setBlockchainOperations     = (data)   =>({ type: SET_BLOCKCHAIN_OPERATIONS, payload: { data }});

export const loadOldBlockchainOperations = ()       =>({ type: LOAD_OLD_BLOCKCHAIN_OPERATIONS});
export const apendBlockchainOperations   = (data)   =>({ type: APEND_BLOCKCHAIN_OPERATIONS, payload: { data }});

export const loadNewBlockchainOperations = ()       =>({ type: LOAD_NEW_BLOCKCHAIN_OPERATIONS});
export const prependBlockchainOperations = (data)   =>({ type: PREPEND_BLOCKCHAIN_OPERATIONS, payload: { data:data }});

export const trySetFilterKeyValue        = (key, value)   =>({ type: TRY_SET_FILTER_KEY_VALUE, payload: { key:key, value:value }});
export const setFilterKeyValue           = (key, value)   =>({ type: SET_FILTER_KEY_VALUE, payload: { key:key, value:value }});
export const deleteFilterKeyValue        = (key)          =>({ type: TRY_SET_FILTER_KEY_VALUE, payload: { key:key , value:{} }});

export const tryFilterOperations         = ()       =>({ type: TRY_FILTER_OPERATIONS });
export const setFilteredOperations       = (opers)  =>({ type: SET_FILTERED_OPERATIONS , payload: { filtered_operations : opers }});

//Eventos que requieren del async
function* loadBlockchainOperationsSaga() {

  const datu = {txs:[{"id":"9e68cb1a9c67d1f7ba2ccbf0fab02e756cf79d4a3402349e58f993ede1d8b406","transaction_id":"9e68cb1a9c67d1f7ba2ccbf0fab02e756cf79d4a3402349e58f993ede1d8b406","block_time":"2019-12-28T17:58:54Z","block_time_number":20191228175854,"block_num":67567545,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd|a ver|transfer_reason_dist","quantity":"7.0000 INK","to":"pablotutino2"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @pablotutino2","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @pablotutino2.","from":"organicvegan","to":"pablotutino2","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":7}],"header":"Money transfer","sub_header":"You sent money to @pablotutino2","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @pablotutino2.","from":"organicvegan","to":"pablotutino2","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":7},{"id":"bc4da0abe40325b8c78359e1c5a2f42aae372c1d6f0b38551ebcb860c77c7e59","transaction_id":"bc4da0abe40325b8c78359e1c5a2f42aae372c1d6f0b38551ebcb860c77c7e59","block_time":"2019-12-28T17:57:35Z","block_time_number":20191228175735,"block_num":67567388,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5e07978b1c04d97b6cbebb10","quantity":"8.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5e07978b1c04d97b6cbebb10","request_counter":null},"i_sent":true,"amount":8}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5e07978b1c04d97b6cbebb10","request_counter":null},"i_sent":true,"amount":8},{"id":"b6293b217d28d497b80a271550a9d761a0b913ec7bc30db1dbac0a9b41d365de","transaction_id":"b6293b217d28d497b80a271550a9d761a0b913ec7bc30db1dbac0a9b41d365de","block_time":"2019-12-28T17:28:51Z","block_time_number":20191228172851,"block_num":67563955,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|undefined","quantity":"3.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"undefined","request_counter":null},"i_sent":true,"amount":3}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"undefined","request_counter":null},"i_sent":true,"amount":3},{"id":"8d551c05a6d0d1f5740b6a8bab51b3d409e30fa0f5c8e0b1c6a866b09869ea8e","transaction_id":"8d551c05a6d0d1f5740b6a8bab51b3d409e30fa0f5c8e0b1c6a866b09869ea8e","block_time":"2019-12-20T12:20:13","block_time_number":20191220122013,"block_num":66161636,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"pay|5dfcb840301b5d0017a7bbc6|me devolves la que te di de mas?","quantity":"5.2100 INK","to":"tutinopablo1"},"operations":[{"header":"Payment","sub_header":"You paid @tutinopablo1","sub_header_admin":"Payment","sub_header_admin_ex":"@organicvegan sent a payment to @tutinopablo1","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":true,"amount":5.21}],"header":"Payment","sub_header":"You paid @tutinopablo1","sub_header_admin":"Payment","sub_header_admin_ex":"@organicvegan sent a payment to @tutinopablo1","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":true,"amount":5.21},{"id":"b5a48219b0f0a2403c0781395f056ebbc9e476e50cbb1bfe4fa566de870c5e34","transaction_id":"b5a48219b0f0a2403c0781395f056ebbc9e476e50cbb1bfe4fa566de870c5e34","block_time":"2019-12-19T18:29:12Z","block_time_number":20191219182912,"block_num":66033688,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5dfbc17559e85c6a50e9c2a6","quantity":"15.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5dfbc17559e85c6a50e9c2a6","request_counter":null},"i_sent":true,"amount":15}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5dfbc17559e85c6a50e9c2a6","request_counter":null},"i_sent":true,"amount":15},{"id":"64093d2e7634f5a390ed7166587c4cb609a007055e1c0aea78f04b760c637ddf","transaction_id":"64093d2e7634f5a390ed7166587c4cb609a007055e1c0aea78f04b760c637ddf","block_time":"2019-12-19T15:11:22","block_time_number":20191219151122,"block_num":66010054,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"aranadalmiro","permission":"active"}],"data":{"from":"aranadalmiro","memo":"pay|5dfb856359e85c6a50e9c2a1|undefined","quantity":"51.1000 INK","to":"organicvegan"},"operations":[{"header":"Payment","sub_header":"@aranadalmiro paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@aranadalmiro sent a payment to @organicvegan","from":"aranadalmiro","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":51.1}],"header":"Payment","sub_header":"@aranadalmiro paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@aranadalmiro sent a payment to @organicvegan","from":"aranadalmiro","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":51.1},{"id":"23d11970a7c36f93be89e401fe29fe7788d51cbac687467ac264294d8486a947","transaction_id":"23d11970a7c36f93be89e401fe29fe7788d51cbac687467ac264294d8486a947","block_time":"2019-12-12T20:01:04","block_time_number":20191212200104,"block_num":64844787,"account":"cristaltoken","name":"upsertpap","authorization":[{"actor":"tutinopablo1","permission":"active"}],"data":{"begins_at":1569898800,"enabled":1,"from":"tutinopablo1","last_charged":0,"memo":"pap|undefined","periods":8,"price":"55.0000 INK","service_id":5,"to":"organicvegan"},"operations":[{"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0}],"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0},{"id":"c5757a198054c5d2b5ffe1afca7d7023266002526bec7ccc3ca1eecd9a7eab68","transaction_id":"c5757a198054c5d2b5ffe1afca7d7023266002526bec7ccc3ca1eecd9a7eab68","block_time":"2019-12-12T18:13:31Z","block_time_number":20191212181331,"block_num":64832064,"account":"cristaltoken","name":"upsertpap","authorization":[{"actor":"aranadalmiro","permission":"active"}],"data":{"begins_at":1569898800,"enabled":1,"from":"aranadalmiro","last_charged":0,"memo":"pap|undefined","periods":3,"price":"13.0000 INK","service_id":2,"to":"organicvegan"},"operations":[{"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0}],"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @aranadalmiro <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0},{"id":"77fab8464b6046a454c17bd9210d581b8285fa3a7dd6bedb4fa92313a36bab1f","transaction_id":"77fab8464b6046a454c17bd9210d581b8285fa3a7dd6bedb4fa92313a36bab1f","block_time":"2019-12-12T17:50:52Z","block_time_number":20191212175052,"block_num":64829481,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df27df95219a750797d24a3","quantity":"5.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df27df95219a750797d24a3","request_counter":null},"i_sent":true,"amount":5}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df27df95219a750797d24a3","request_counter":null},"i_sent":true,"amount":5},{"id":"18c1a6657406bfd9ed8a939008682c51f037f285ac78ff298b8fd2aa082d2c2d","transaction_id":"18c1a6657406bfd9ed8a939008682c51f037f285ac78ff298b8fd2aa082d2c2d","block_time":"2019-12-12T13:13:41","block_time_number":20191212131341,"block_num":64796506,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"wth|5df23d049cd06217c45ad038","quantity":"25.0000 INK","to":"cristaltoken"},"operations":[{"header":"Withdraw","sub_header":"Withdraw","sub_header_admin":"Withdraw","sub_header_admin_ex":"@organicvegan transferred for a Withdraw","from":"organicvegan","tx_type":"transfer_wth","request":{"requested_type":"type_withdraw","request_id":"5df23d049cd06217c45ad038","request_counter":null},"i_sent":true,"amount":25}],"header":"Withdraw","sub_header":"Withdraw","sub_header_admin":"Withdraw","sub_header_admin_ex":"@organicvegan transferred for a Withdraw","from":"organicvegan","tx_type":"transfer_wth","request":{"requested_type":"type_withdraw","request_id":"5df23d049cd06217c45ad038","request_counter":null},"i_sent":true,"amount":25},{"id":"c5be228d69963f5d46dc4b1274b7f31869e5dc144cdfa572a2429a089dd35f5c","transaction_id":"c5be228d69963f5d46dc4b1274b7f31869e5dc144cdfa572a2429a089dd35f5c","block_time":"2019-12-11T23:04:41Z","block_time_number":20191211230441,"block_num":64697072,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df1760671bb391880becf59","quantity":"5.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df1760671bb391880becf59","request_counter":null},"i_sent":true,"amount":5}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df1760671bb391880becf59","request_counter":null},"i_sent":true,"amount":5},{"id":"c884da365e8a2366d33aaf2b7a34b2de132f3ab0b893d50d5877afa8a0aadeb7","transaction_id":"c884da365e8a2366d33aaf2b7a34b2de132f3ab0b893d50d5877afa8a0aadeb7","block_time":"2019-12-11T23:03:34","block_time_number":20191211230334,"block_num":64696939,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df175c371bb391880becf58","quantity":"1.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df175c371bb391880becf58","request_counter":null},"i_sent":true,"amount":1}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df175c371bb391880becf58","request_counter":null},"i_sent":true,"amount":1},{"id":"8ac55612f0fd593e1f6378766794c4c14eac1cd94e28345524ce3f8bc7103367","transaction_id":"8ac55612f0fd593e1f6378766794c4c14eac1cd94e28345524ce3f8bc7103367","block_time":"2019-12-11T22:58:39Z","block_time_number":20191211225839,"block_num":64696350,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df1749d71bb391880becf57","quantity":"4.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df1749d71bb391880becf57","request_counter":null},"i_sent":true,"amount":4}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df1749d71bb391880becf57","request_counter":null},"i_sent":true,"amount":4},{"id":"c09cddc0fe30f75ba03411c771217bdb075f82ccbcbacdb1317de457d12b01e8","transaction_id":"c09cddc0fe30f75ba03411c771217bdb075f82ccbcbacdb1317de457d12b01e8","block_time":"2019-12-11T22:50:11","block_time_number":20191211225011,"block_num":64695340,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df172a171bb391880becf56","quantity":"5.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df172a171bb391880becf56","request_counter":null},"i_sent":true,"amount":5}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df172a171bb391880becf56","request_counter":null},"i_sent":true,"amount":5},{"id":"4e2c08a95875985141b99281bbd65f9bc1fe988e7f8fb5c0fd63370274ce4762","transaction_id":"4e2c08a95875985141b99281bbd65f9bc1fe988e7f8fb5c0fd63370274ce4762","block_time":"2019-12-11T22:45:59","block_time_number":20191211224559,"block_num":64694838,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5df171a571bb391880becf55","quantity":"4.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df171a571bb391880becf55","request_counter":null},"i_sent":true,"amount":4}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5df171a571bb391880becf55","request_counter":null},"i_sent":true,"amount":4},{"id":"95d5f7deb3fe33353b488a5e59cece4f2c9c17a51edc461b7266c28c00e6c8f8","transaction_id":"95d5f7deb3fe33353b488a5e59cece4f2c9c17a51edc461b7266c28c00e6c8f8","block_time":"2019-12-11T22:14:00","block_time_number":20191211221400,"block_num":64691057,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"f39bf42e6e459fa5e0fde385fa521bd40349d38fc286536a603d09e66d36ed1f","transaction_id":"f39bf42e6e459fa5e0fde385fa521bd40349d38fc286536a603d09e66d36ed1f","block_time":"2019-12-11T22:13:24","block_time_number":20191211221324,"block_num":64690985,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"b6e606c901fc9640c6f15dd6146535e847791f2abeaae6335e636dea983a8376","transaction_id":"b6e606c901fc9640c6f15dd6146535e847791f2abeaae6335e636dea983a8376","block_time":"2019-12-11T22:12:20Z","block_time_number":20191211221220,"block_num":64690857,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"1b2f6c7b889fbb454a1bff60b0c155fa7737bbf733fb46a152a324a534517ba0","transaction_id":"1b2f6c7b889fbb454a1bff60b0c155fa7737bbf733fb46a152a324a534517ba0","block_time":"2019-12-11T22:10:48","block_time_number":20191211221048,"block_num":64690674,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"6797881a652659818ec0819354be6828372e4813c0fa2444eb99cddfe50452eb","transaction_id":"6797881a652659818ec0819354be6828372e4813c0fa2444eb99cddfe50452eb","block_time":"2019-12-11T22:09:42Z","block_time_number":20191211220942,"block_num":64690542,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"b7ed67eaf62ad11a42a632587c5c42e40fbfbdce70bbdcd01ff5f4497afda977","transaction_id":"b7ed67eaf62ad11a42a632587c5c42e40fbfbdce70bbdcd01ff5f4497afda977","block_time":"2019-12-11T22:03:30Z","block_time_number":20191211220330,"block_num":64689815,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1},{"id":"c117179fb7b370bebc5b43ee55e7279a735b408f33b5ba50b52b8a7ff507b6a5","transaction_id":"c117179fb7b370bebc5b43ee55e7279a735b408f33b5ba50b52b8a7ff507b6a5","block_time":"2019-12-11T22:02:48Z","block_time_number":20191211220248,"block_num":64689731,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"2.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":2}],"header":"Money transfer","sub_header":"You sent money to @aranadalmiro","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @aranadalmiro.","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":2},{"id":"ffbd5dcc563fd2466018659553f4bb5da3848350ddb08f8b4921053b8d81a0b5","transaction_id":"ffbd5dcc563fd2466018659553f4bb5da3848350ddb08f8b4921053b8d81a0b5","block_time":"2019-12-11T22:00:19","block_time_number":20191211220019,"block_num":64689445,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_rent","quantity":"5.0000 INK","to":"tutinopablo1"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":5}],"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":5},{"id":"eb30f781a43f4cdd09942471a513264350763ceecd5ce368a763f420f4e08476","transaction_id":"eb30f781a43f4cdd09942471a513264350763ceecd5ce368a763f420f4e08476","block_time":"2019-12-11T19:22:44","block_time_number":20191211192244,"block_num":64670715,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"slr|Ref. Novembro 2019|2019/11","quantity":"120.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Salary Payment","sub_header":"You paid salary to @aranadalmiro. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @aranadalmiro. - Ref. Novembro 2019","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":120},{"header":"Salary Payment","sub_header":"You paid salary to @tutinopablo1. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @tutinopablo1. - Ref. Novembro 2019","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":125}],"header":"Salary Payment","sub_header":"You paid salary to @aranadalmiro. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @aranadalmiro. - Ref. Novembro 2019","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":245},{"id":"7789df6c33cfed2f28399f2879f0209046b01dd922304b6c7ee9d09200b478b1","transaction_id":"7789df6c33cfed2f28399f2879f0209046b01dd922304b6c7ee9d09200b478b1","block_time":"2019-12-08T07:40:30","block_time_number":20191208074030,"block_num":64084541,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"2.1000 INK","to":"biz112345abc"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":2.1}],"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":2.1},{"id":"856324ee4e45482093d79c8a959397f2cbe2c081480274d5c4abfc83caeefd9f","transaction_id":"856324ee4e45482093d79c8a959397f2cbe2c081480274d5c4abfc83caeefd9f","block_time":"2019-12-08T07:38:59Z","block_time_number":20191208073859,"block_num":64084373,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd||tx_r_adjustment","quantity":"1.2300 INK","to":"tutinopablo1"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.23}],"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.23},{"id":"e52ca4c0f38dc44f18d064a3e2794b81dad3b9ef41dded5e3233a2f130244a5c","transaction_id":"e52ca4c0f38dc44f18d064a3e2794b81dad3b9ef41dded5e3233a2f130244a5c","block_time":"2019-12-08T07:07:58Z","block_time_number":20191208070758,"block_num":64080875,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd|sss|tx_r_adjustment","quantity":"1.3000 INK","to":"biz112345abc"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.3}],"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.3},{"id":"ba6194ff414fcba17e01856eb697e063731a1487ba4b441a5d6e6943fa527d9d","transaction_id":"ba6194ff414fcba17e01856eb697e063731a1487ba4b441a5d6e6943fa527d9d","block_time":"2019-12-08T07:01:16","block_time_number":20191208070116,"block_num":64080079,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd|daaaaale|tx_r_adjustment","quantity":"1.5000 INK","to":"tutinopablo1"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.5}],"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":1.5},{"id":"abe2453234e70f60df1c37d4caab69d075ea720db5be641bf63d322f88395595","transaction_id":"abe2453234e70f60df1c37d4caab69d075ea720db5be641bf63d322f88395595","block_time":"2019-12-06T03:32:09","block_time_number":20191206033209,"block_num":63712671,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"slr|Ref. Novembro 2019|2019/11","quantity":"10.0000 INK","to":"aranadalmiro"},"operations":[{"header":"Salary Payment","sub_header":"You paid salary to @aranadalmiro. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @aranadalmiro. - Ref. Novembro 2019","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":10},{"header":"Salary Payment","sub_header":"You paid salary to @tutinopablo1. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @tutinopablo1. - Ref. Novembro 2019","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":5}],"header":"Salary Payment","sub_header":"You paid salary to @aranadalmiro. - Ref. Novembro 2019","sub_header_admin":"You paid salary to","sub_header_admin_ex":"@organicvegan paid salary to @aranadalmiro. - Ref. Novembro 2019","from":"organicvegan","to":"aranadalmiro","tx_type":"transfer_slr","request":{"requested_type":"type_salary","request_id":null,"request_counter":null},"i_sent":true,"amount":15},{"id":"034b36afe9658834429db9a1d88fe83f14fb25b985d3fccc63c6bae0334b971c","transaction_id":"034b36afe9658834429db9a1d88fe83f14fb25b985d3fccc63c6bae0334b971c","block_time":"2019-12-06T03:27:11","block_time_number":20191206032711,"block_num":63712079,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd|ahi vaaaaa|tx_r_another","quantity":"450.0000 INK","to":"tutinopablo1"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":450}],"header":"Money transfer","sub_header":"You sent money to @tutinopablo1","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @tutinopablo1.","from":"organicvegan","to":"tutinopablo1","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":450},{"id":"118083cc31b94c51f717753d8c1c1d0c77c8eee5fea193a45e5839e1c2d6d9de","transaction_id":"118083cc31b94c51f717753d8c1c1d0c77c8eee5fea193a45e5839e1c2d6d9de","block_time":"2019-12-06T03:26:47","block_time_number":20191206032647,"block_num":63712031,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5de9ca75e7c8932c52a27ad0","quantity":"7.5000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5de9ca75e7c8932c52a27ad0","request_counter":null},"i_sent":true,"amount":7.5}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5de9ca75e7c8932c52a27ad0","request_counter":null},"i_sent":true,"amount":7.5},{"id":"567bfe0ecc14c9ce1946e8f06efa901b85f9b4aa3674d81bd701f97de2b673fd","transaction_id":"567bfe0ecc14c9ce1946e8f06efa901b85f9b4aa3674d81bd701f97de2b673fd","block_time":"2019-12-06T03:25:40","block_time_number":20191206032540,"block_num":63711899,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"aranadalmiro","permission":"active"}],"data":{"from":"aranadalmiro","memo":"pay|Payed at store.","quantity":"1.0000 INK","to":"organicvegan"},"operations":[{"header":"Payment","sub_header":"@aranadalmiro paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@aranadalmiro sent a payment to @organicvegan","from":"aranadalmiro","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":1}],"header":"Payment","sub_header":"@aranadalmiro paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@aranadalmiro sent a payment to @organicvegan","from":"aranadalmiro","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":1},{"id":"dbe64202bec29dd328b7ed8ce0308b8616ea1acaf7f6743b84b096cecb637ca9","transaction_id":"dbe64202bec29dd328b7ed8ce0308b8616ea1acaf7f6743b84b096cecb637ca9","block_time":"2019-12-06T03:25:07Z","block_time_number":20191206032507,"block_num":63711832,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"tutinopablo1","permission":"active"}],"data":{"from":"tutinopablo1","memo":"snd|testeando balance update","quantity":"0.5000 INK","to":"organicvegan"},"operations":[{"header":"Money transfer","sub_header":"@tutinopablo1 sent you money","sub_header_admin":"Money transfer","sub_header_admin_ex":"@tutinopablo1 sent money to @organicvegan.","from":"tutinopablo1","to":"organicvegan","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":false,"amount":0.5}],"header":"Money transfer","sub_header":"@tutinopablo1 sent you money","sub_header_admin":"Money transfer","sub_header_admin_ex":"@tutinopablo1 sent money to @organicvegan.","from":"tutinopablo1","to":"organicvegan","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":false,"amount":0.5},{"id":"b52cb1ac07f2c3e08c15bb1054ebb97c8218e7d538cf141d602d45446762ef3d","transaction_id":"b52cb1ac07f2c3e08c15bb1054ebb97c8218e7d538cf141d602d45446762ef3d","block_time":"2019-12-06T02:55:42Z","block_time_number":20191206025542,"block_num":63708332,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"prv|5de9c32c8aaa692a7ce6d71b","quantity":"50.0000 INK","to":"cristaltoken"},"operations":[{"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5de9c32c8aaa692a7ce6d71b","request_counter":null},"i_sent":true,"amount":50}],"header":"Provider payment","sub_header":"Provider payment","sub_header_admin":"Provider payment","sub_header_admin_ex":"@organicvegan transfered for a Provider payment","from":"organicvegan","tx_type":"transfer_prv","request":{"requested_type":"type_provider","request_id":"5de9c32c8aaa692a7ce6d71b","request_counter":null},"i_sent":true,"amount":50},{"id":"b8e1346074f369cb0bc0423d774938dadc85634ed3babc8db5c3e0b300c7ec64","transaction_id":"b8e1346074f369cb0bc0423d774938dadc85634ed3babc8db5c3e0b300c7ec64","block_time":"2019-12-05T21:44:46","block_time_number":20191205214446,"block_num":63671743,"account":"cristaltoken","name":"upsertpap","authorization":[{"actor":"biz112345abc","permission":"active"}],"data":{"begins_at":1569898800,"enabled":1,"from":"biz112345abc","last_charged":0,"memo":"pap|undefined","periods":6,"price":"8.3000 INK","service_id":4,"to":"organicvegan"},"operations":[{"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0}],"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @biz112345abc <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0},{"id":"e95524b0b9120f93d9bec02af69b0203fdab7f7d23b0c1c904d74ca4a957f316","transaction_id":"e95524b0b9120f93d9bec02af69b0203fdab7f7d23b0c1c904d74ca4a957f316","block_time":"2019-12-05T20:43:45Z","block_time_number":20191205204345,"block_num":63664482,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"organicvegan","memo":"snd|testing account selector widget|tx_r_adjustment","quantity":"50.0000 INK","to":"biz112345abc"},"operations":[{"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":50}],"header":"Money transfer","sub_header":"You sent money to @biz112345abc","sub_header_admin":"Money transfer","sub_header_admin_ex":"@organicvegan sent money to @biz112345abc.","from":"organicvegan","to":"biz112345abc","tx_type":"transfer_snd","request":{"requested_type":"type_send","request_id":null,"request_counter":null},"i_sent":true,"amount":50},{"id":"5b6ab8932771ce122a52141944d428fba60a36acf1ca93978525885390ada688","transaction_id":"5b6ab8932771ce122a52141944d428fba60a36acf1ca93978525885390ada688","block_time":"2019-12-05T12:38:49","block_time_number":20191205123849,"block_num":63606865,"account":"cristaltoken","name":"transfer","authorization":[{"actor":"tutinopablo1","permission":"active"}],"data":{"from":"tutinopablo1","memo":"pay|Payed at store.","quantity":"3.0000 INK","to":"organicvegan"},"operations":[{"header":"Payment","sub_header":"@tutinopablo1 paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@tutinopablo1 sent a payment to @organicvegan","from":"tutinopablo1","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":3}],"header":"Payment","sub_header":"@tutinopablo1 paid you","sub_header_admin":"Payment","sub_header_admin_ex":"@tutinopablo1 sent a payment to @organicvegan","from":"tutinopablo1","to":"organicvegan","tx_type":"transfer_pay","request":{"requested_type":"type_payment","request_id":null,"request_counter":null},"i_sent":false,"amount":3},{"id":"40fae13fe8684c0c8be2d963f50cbeb06241ab83d678c09b462a55e9f83f2b02","transaction_id":"40fae13fe8684c0c8be2d963f50cbeb06241ab83d678c09b462a55e9f83f2b02","block_time":"2019-12-03T18:38:58","block_time_number":20191203183858,"block_num":63307461,"account":"cristaltoken","name":"chargepap","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"tutinopablo1","memo":"pap|pay|3","quantity":"9.0000 INK","service_id":3,"to":"organicvegan"},"operations":[{"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":9}],"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 3 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":9},{"id":"cab40aacd5b2f43ef205ea52b8d02e6df88d507276f44197b4f42d321a9bcd95","transaction_id":"cab40aacd5b2f43ef205ea52b8d02e6df88d507276f44197b4f42d321a9bcd95","block_time":"2019-12-03T18:32:48","block_time_number":20191203183248,"block_num":63306727,"account":"cristaltoken","name":"chargepap","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"tutinopablo1","memo":"pap|pay|2","quantity":"9.0000 INK","service_id":3,"to":"organicvegan"},"operations":[{"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":9}],"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 2 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":9},{"id":"c709ffed61f2fb7da505aaf4196d48fe2667ae0f28d343165e923b2db29c9586","transaction_id":"c709ffed61f2fb7da505aaf4196d48fe2667ae0f28d343165e923b2db29c9586","block_time":"2019-12-03T15:08:05","block_time_number":20191203150805,"block_num":63282383,"account":"cristaltoken","name":"chargepap","authorization":[{"actor":"organicvegan","permission":"active"}],"data":{"from":"tutinopablo1","memo":"pap|pay|1","service_id":3,"to":"organicvegan"},"operations":[{"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0}],"header":"Charge Pre Authorized Payment$","sub_header":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","sub_header_admin_ex":"Charge Pre Authorized Payment - Period 1 paid. Customer @tutinopablo1 <-> Provider @organicvegan#3","tx_type":"chargepap_pap","request":{"requested_type":"type_charge_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0},{"id":"8952f686cd048d34a743e500222164a34ac31b1773311efae19c955f7314421e","transaction_id":"8952f686cd048d34a743e500222164a34ac31b1773311efae19c955f7314421e","block_time":"2019-12-03T11:47:34","block_time_number":20191203114734,"block_num":63258514,"account":"cristaltoken","name":"upsertpap","authorization":[{"actor":"tutinopablo1","permission":"active"}],"data":{"begins_at":1561950000,"enabled":1,"from":"tutinopablo1","last_charged":0,"memo":"pap|undefined","periods":6,"price":"9.0000 INK","service_id":3,"to":"organicvegan"},"operations":[{"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0}],"header":"Pre Authorized Payment Agreement","sub_header":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","sub_header_admin_ex":"Pre Authorized Payment. Customer @tutinopablo1 <-> Provider @organicvegan","tx_type":"upsertpap_pap","request":{"requested_type":"type_upsert_pap","request_id":null,"request_counter":null},"i_sent":false,"amount":0},{"id":"a3f877b1de7cba1bd2e3a4d1c75e2754259cc758b1870fc76e5e78ba3d272ed6","transaction_id":"a3f877b1de7cba1bd2e3a4d1c75e2754259cc758b1870fc76e5e78ba3d272ed6","block_time":"2019-11-28T20:26:16","block_time_number":20191128202616,"block_num":62467323,"account":"eosio","name":"newaccount","authorization":[{"actor":"cristaltoken","permission":"active"}],"data":{"active":{"accounts":[],"keys":[{"key":"EOS6D1h6gcE5MfJ2rgeXXPERiaSRM9unM7pn6g2nCJKKAQnVBvEKv","weight":1}],"threshold":1,"waits":[]},"creator":"cristaltoken","name":"organicvegan","owner":{"accounts":[{"permission":{"actor":"cristaltoken","permission":"active"},"weight":1},{"permission":{"actor":"tutinopablo1","permission":"active"},"weight":1}],"keys":[{"key":"EOS6D1h6gcE5MfJ2rgeXXPERiaSRM9unM7pn6g2nCJKKAQnVBvEKv","weight":1}],"threshold":1,"waits":[]}},"operations":[{"header":"Account creation/edition","sub_header":"Account creation/edition: @organicvegan","sub_header_admin":"Account creation/edition: @organicvegan","sub_header_admin_ex":"Account creation/edition: @organicvegan","tx_type":"newaccount_","request":{"requested_type":"type_new_account","request_id":null,"request_counter":null},"i_sent":true,"amount":0},{"header":"buyrambytes - buyrambytes_","sub_header":"buyrambytes - buyrambytes_","sub_header_admin":"buyrambytes - buyrambytes_","sub_header_admin_ex":"buyrambytes - buyrambytes_","tx_type":"buyrambytes_","request":{"requested_type":"type_unknown","request_id":null,"request_counter":null},"i_sent":true,"amount":0},{"header":"delegatebw - delegatebw_","sub_header":"delegatebw - delegatebw_","sub_header_admin":"delegatebw - delegatebw_","sub_header_admin_ex":"delegatebw - delegatebw_","tx_type":"delegatebw_","request":{"requested_type":"type_unknown","request_id":null,"request_counter":null},"i_sent":true,"amount":0},{"header":"Customer creation/edition","sub_header":"Customer creation/edition: @organicvegan. Type: business","sub_header_admin":"Customer creation/edition: @organicvegan. Type: business","sub_header_admin_ex":"Customer creation/edition: @organicvegan. Type: business","tx_type":"upsertcust_","request":{"requested_type":"type_upsert_cust","request_id":null,"request_counter":null},"i_sent":true,"amount":0}],"header":"Account creation/edition","sub_header":"Account creation/edition: @organicvegan","sub_header_admin":"Account creation/edition: @organicvegan","sub_header_admin_ex":"Account creation/edition: @organicvegan","tx_type":"newaccount_","request":{"requested_type":"type_new_account","request_id":null,"request_counter":null},"i_sent":true,"amount":0}], cursor:''};
  yield put(setBlockchainOperations(datu))
  yield put({ type: TRY_FILTER_OPERATIONS })

  return;
  const { permissioner } = store.getState().login.current_account;
  try
  {
    const {data} = yield api.dfuse.queryTransactions(permissioner );
    console.log(' loadBlockchainOperationsSaga# ABOUT TO PUT!')
    if(data) {
        yield put(setBlockchainOperations(data))
        console.log('about to call TRY_FILTER_OPERATIONS')
        yield put({ type: TRY_FILTER_OPERATIONS })
    }
  }
  catch(e){
    //HACK Mandar error a GLOBAL_ERROR_HANDLER
    console.log(' loadBlockchainOperationsSaga#ERROR#1:', JSON.stringify(e))
    yield put({ type: END_LOAD_BLOCKCHAIN_OPERATIONS })
    return;
  }
  
}

function* loadOldBlockchainOperationsSaga() {
  const { operations_cursor } = store.getState().operations;
  const { permissioner }      = store.getState().login.current_account;
  if(!operations_cursor)
  {  
    yield put({ type: END_LOAD_BLOCKCHAIN_OPERATIONS })
    return;
  }

  try{
    const {data} = yield api.dfuse.queryTransactionsCursor(permissioner, operations_cursor);
    if(data) {
        yield put(apendBlockchainOperations(data))
        yield put({ type: TRY_FILTER_OPERATIONS })
    }
  }
  catch(e)
  {
    console.log(' loadOldBlockchainOperationsSaga#ERROR#2:', JSON.stringify(e))
    //HACK Mandar error a GLOBAL_ERROR_HANDLER
    yield put({ type: END_LOAD_BLOCKCHAIN_OPERATIONS })
    return;
  }
  
}

function* loadNewBlockchainOperationsSaga() {
  const { permissioner }   = store.getState().login.current_account;
  const { last_block }     = store.getState().operations;
  if(!last_block)
  {    
    yield put({ type: END_LOAD_BLOCKCHAIN_OPERATIONS })
    return;
  }
  
  try{
    const {data} = yield api.dfuse.queryTransactionsNew(permissioner, last_block);
    if(data) {
      yield put(prependBlockchainOperations(data))
      yield put({ type: TRY_FILTER_OPERATIONS })
    }

  }
  catch(e)
  {
    console.log(' loadNewBlockchainOperationsSaga#ERROR#3:', JSON.stringify(e))
    //HACK Mandar error a GLOBAL_ERROR_HANDLER
    yield put({ type: END_LOAD_BLOCKCHAIN_OPERATIONS })
    return;
  }
}
  
function* trySetFiltersSaga({ type, payload }){
  const {key, value} = payload;
  yield put(setFilterKeyValue(key, value));
  yield put({ type: TRY_FILTER_OPERATIONS })

}

const comparer = {
  from : (filter, oper)             => { return !filter || oper.data.from==filter }
  , to : (filter, oper)             => { return !filter || oper.data.to==filter }
  , requested_type : (filter, oper) => { return utils.arrayNullOrEmpty(filter, true) || oper.request && filter.includes(oper.request.requested_type) }
  , date_range : (filter, oper)     => { 
    // console.log(' --- ')
    // console.log('oper.block_time_number = ', oper.block_time_number)
    // console.log('filter[0] = ' , utils.dateToNumber(filter[0]));
    // console.log('filter[1] = ' , utils.dateToNumber(filter[1]));
    // oper.block_time_number>=utils.dateToNumber(filter[0]) && oper.block_time_number<=utils.dateToNumber(filter[1]
    const my_date = moment(oper.block_time);
    return utils.arrayNullOrEmpty(filter, true) || (my_date.isSameOrAfter(filter[0]) && my_date.isSameOrBefore(filter[1]));
  }
}

function* tryFilterOperationsSaga(){
  
  const raw_operations = store.getState().operations.raw_operations;
  const filters        = store.getState().operations.filter_key_values;

  if(!raw_operations || !filters){
    // fire error ?
    console.log(' NO se puede filtrar papa!!')
    yield put( setFilteredOperations( raw_operations||{} ) )
    return;
  }

  // console.log(JSON.stringify(raw_operations));

  try{
    const filters_keys = Object.keys(filters);
    
    const filtered_operations = filters_keys.map(
      (filter_key) => {
        const filter               = filters[filter_key];
        const current_filter_keys  = Object.keys(filter);
        if(!current_filter_keys.length)
        {
          return [...raw_operations];
        }
        return raw_operations.filter( (oper) => {
          
          const comparison = _.reduce(filter, function(result, value, key) {
              const _ok = comparer[key](value, oper)
              return _ok ?
                  result.concat(key) : result;
          }, []);

          return comparison.length>=current_filter_keys.length

        });   
      }
    )
    
    const ret = _.zipObject(filters_keys, filtered_operations)
    // console.log('zipObject:', JSON.stringify(ret))
    yield put( setFilteredOperations(ret||{}) )
  }catch(e){
    console.log(' -- tryFilterOperationsSaga: exception', JSON.stringify(e))
    console.log(' filter:', JSON.stringify(filters))
    // ToDo: putError!
  }
}


function* initOperationsReduxSaga () {
  console.log( ' # core.INIT@operations-saga ' )
  // yield put({type: core.ACTION_START, payload: { loadBlockchainOperations: 'Loading blockahin operations'}})
  yield call(loadBlockchainOperationsSaga)
  // yield put({type: core.ACTION_END, payload: 'loadBlockchainOperations'})
}

//Se envan las sagas a redux estableciendo que y cuantas veces dispara la funcin
store.injectSaga('operations', [
  takeEvery(core.INIT_READY_TO_START, initOperationsReduxSaga),
  takeEvery(LOAD_BLOCKCHAIN_OPERATIONS, loadBlockchainOperationsSaga),
  takeEvery(LOAD_OLD_BLOCKCHAIN_OPERATIONS, loadOldBlockchainOperationsSaga),
  takeEvery(LOAD_NEW_BLOCKCHAIN_OPERATIONS, loadNewBlockchainOperationsSaga),

  takeEvery(TRY_SET_FILTER_KEY_VALUE, trySetFiltersSaga),
  
  takeEvery(TRY_FILTER_OPERATIONS, tryFilterOperationsSaga),

]);

// Selectores - Conocen el stado y retornan la info que es necesaria
export const operations           = (state) => state.operations.operations;
export const rawOperations        = (state) => state.operations.raw_operations;
export const operationsCursor     = (state) => state.operations.operations_cursor;
export const isOperationsLoading  = (state) => state.operations.is_operations_loading
export const filterKeyValues      = (state) => state.operations.filter_key_values;

// El reducer del modelo
const defaultState = {
  operations:             {},
  raw_operations:         [],
  is_operations_loading:  false,
  last_block:             null,
  operations_cursor:      null,
  filter_key_values:      {} 
}

function reducer(state = defaultState, action = {}) {
  
  switch (action.type) {
    case TRY_FILTER_OPERATIONS:
      return {
        ...state,
        is_operations_loading:     false
      }
    break;

    case END_LOAD_BLOCKCHAIN_OPERATIONS:
      return {
        ...state,
        is_operations_loading:     false
      }
    break;
    
    case LOAD_NEW_BLOCKCHAIN_OPERATIONS:   
      return {
        ...state,
        is_operations_loading:     true
      }
    case PREPEND_BLOCKCHAIN_OPERATIONS: 
      const current_operations1 = state.raw_operations||[];
      return  {
        ...state
        , raw_operations:          [...action.payload.data.txs, ...current_operations1]
        , operations_cursor:       action.payload.data.cursor
        , is_operations_loading:   false
      }

    case LOAD_OLD_BLOCKCHAIN_OPERATIONS:   
      return {
        ...state,
        is_operations_loading:     true
      }
    case APEND_BLOCKCHAIN_OPERATIONS: 
      const current_operations2 = state.raw_operations||[];
      return  {
        ...state
        , raw_operations:          [...current_operations2, ...action.payload.data.txs ]
        , operations_cursor:       action.payload.data.cursor
        , is_operations_loading:   false
      }

    case LOAD_BLOCKCHAIN_OPERATIONS: 
      return {
        ...state,
        is_operations_loading:     true
      }
    case SET_BLOCKCHAIN_OPERATIONS:
      const {txs, cursor} = action.payload.data 
      const last_block = (txs&&txs.length>0)
        ? txs[0].block_num
        : state.last_block;
      
      return  {
        ...state
        , raw_operations:          txs 
        , operations_cursor:       cursor
        , last_block:              last_block 
        , is_operations_loading:   false
      }
    case SET_FILTER_KEY_VALUE:
      let _filter_key_values = state.filter_key_values;
      return  {
        ...state,
        filter_key_values : { ..._filter_key_values, [action.payload.key] : action.payload.value }
      }
    case SET_FILTERED_OPERATIONS:
      // console.log(' redux-operations::SET_FILTERED_OPERATIONS: ', JSON.stringify(action.payload.filtered_operations))
      return  {
        ...state
        , operations:              action.payload.filtered_operations
        , is_operations_loading:   false
      }
    default: return state;
  }
}

store.injectReducer('operations', reducer)
